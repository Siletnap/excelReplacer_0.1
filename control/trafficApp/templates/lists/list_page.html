{% extends 'base.html' %}
{% load static %}

{% block title %}<title>{{ page_title }}</title>{% endblock %}

{% block content %}
  <script src="{% static 'js/calendarAppear.js' %}" defer></script>
  <script src="{% static 'js/columns.js' %}" defer></script>
  <script src="{% static 'js/trafficSubmitForm.js' %}" defer></script>



  <h1>{{ page_title }}</h1>

  <form method="post">
    {% csrf_token %}
    {% if form.non_field_errors %}
      <script>alert("{{ form.non_field_errors|join:'\\n'|escapejs }}");</script>
    {% endif %}
    <div class="two-fields">
      {% include form_partial with form=form %}
    </div>
  </form>

  {% include "lists/_controls/_column_picker.html" with column_list=column_list %}
  {% include "lists/_controls/_search_only.html" %}

  {% include "lists/_table.html" with column_list=column_list row_partial=row_partial object_list=object_list %}

    <dialog id="trafficDialog" aria-modal="true">
      <form id="trafficForm" method="post" action="{% url 'traffic-create' %}">
          {% csrf_token %}
          <input type="hidden" name="boat_id" id="id_boat_id" value="">
          <h3>New Traffic Entry</h3>

          {# boatType: non-interactive via CSS, but still submitted #}
          <div class="field-group" id="id_boatType">
            {{ traffic_form.boatType.label_tag }} {{ traffic_form.boatType}}
          </div>

          {# name/berth: read-only (still submitted) #}
          <div class="field-group" id="id_name">
            {{ traffic_form.name.label_tag }} {{ traffic_form.name}}
          </div>
          <div class="field-group" id="id_berth">
            {{ traffic_form.berth.label_tag }} {{ traffic_form.berth}}
          </div>

          {# Prefilled but editable #}
          <div class="field-group" id="id_trDate">
            {{ traffic_form.trDate.label_tag }} {{ traffic_form.trDate }}
          </div>
          <div class="field-group" id="id_trTime">
            {{ traffic_form.trTime.label_tag }} {{ traffic_form.trTime }}
          </div>

          {# Direction (weâ€™ll prefill in JS, but user can change) #}
          <div class="field-group" id="id_direction">
            {{ traffic_form.direction.label_tag }} {{ traffic_form.direction }}
          </div>

          {# The rest blank #}
          <div class="field-group">
            {{ traffic_form.passengers.label_tag }} {{ traffic_form.passengers }}
          </div>
          <div class="field-group">
            {{ traffic_form.purpose.label_tag }} {{ traffic_form.purpose }}
          </div>
          <div class="field-group">
            {{ traffic_form.edr.label_tag }} {{ traffic_form.edr }}
          </div>
          <div class="field-group">
            {{ traffic_form.etr.label_tag }} {{ traffic_form.etr }}
          </div>
          <div class="field-group">
            {{ traffic_form.trComments.label_tag }} {{ traffic_form.trComments }}
          </div>

          <menu>
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" id="trafficCancel" class="btn btn-secondary">Cancel</button>
          </menu>

          <div id="trafficErrors" class="text-danger" style="margin-top:8px;"></div>
        </form>

    </dialog>
{% endblock %}
